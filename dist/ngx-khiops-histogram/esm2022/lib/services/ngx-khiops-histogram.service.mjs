import { Injectable } from '@angular/core';
import { HistogramBarVO } from '../model/ngx-khiops-histogram.bar-vo';
import { HistogramType } from '../model/ngx-khiops-histogram.types';
import * as i0 from "@angular/core";
export class HistogramService {
    constructor() {
        this.rangeXLin = {};
        this.rangeYLin = 0;
        this.rangeYLog = {
            min: 0,
            max: 0,
        };
        this.rangeXLog = {};
    }
    getRangeX(datas) {
        this.rangeXLog.inf = datas.find(function (d) {
            return d.partition[0] === 0 || d.partition[1] === 0;
        });
        this.rangeXLog.min = datas[0].partition[0];
        this.rangeXLog.negValuesCount = datas.filter(function (d) {
            return d.partition[1] < 0;
        })?.length;
        this.rangeXLog.posValuesCount = datas.filter(function (d) {
            return d.partition[1] > 0;
        })?.length;
        if (this.rangeXLog.inf) {
            // 0 exist
            this.rangeXLog.negStart =
                // @ts-ignore update it with es2023
                datas.findLast(function (d) {
                    return d.partition[0] < 0 && d.partition[1] <= 0;
                })?.partition[0] || undefined;
            this.rangeXLog.posStart =
                datas.find(function (d) {
                    return d.partition[0] > 0 && d.partition[1] > 0;
                })?.partition[0] || undefined;
        }
        else {
            this.rangeXLog.negStart =
                // @ts-ignore update it with es2023
                datas.findLast(function (d) {
                    return d.partition[0] < 0 && d.partition[1] <= 0;
                })?.partition[1] || undefined;
            this.rangeXLog.posStart =
                datas.find(function (d) {
                    return d.partition[0] > 0 && d.partition[1] > 0;
                })?.partition[0] || undefined;
        }
        this.rangeXLog.max = datas[datas.length - 1].partition[1];
        this.rangeXLog.middlewidth = 1.2;
        this.rangeXLin.min = datas[0].partition[0];
        this.rangeXLin.max = datas[datas.length - 1].partition[1];
        return [this.rangeXLin, this.rangeXLog];
    }
    getLinRangeY(datas) {
        const dataValues = datas.map((d) => d.value);
        this.rangeYLin = Math.max(...dataValues);
        return this.rangeYLin;
    }
    getLogRangeY(datas) {
        const dataValues = datas.map((e) => e.logValue).filter((e) => e !== 0);
        this.rangeYLog.max = Math.max(...dataValues);
        this.rangeYLog.min = Math.min(...dataValues);
        return this.rangeYLog;
    }
    getLinRatioY(h, padding = 0) {
        let ratioY = (h - padding / 2) / this.rangeYLin;
        return ratioY;
    }
    getLogRatioY(h, padding = 0) {
        let ratioY;
        // @ts-ignore
        let shift = Math.abs(this.rangeYLog.min) - Math.abs(this.rangeYLog.max);
        ratioY = (h - padding / 2) / shift;
        return ratioY;
    }
    computeXbarsDimensions(datas, xType) {
        let bars = [];
        datas.forEach((d, i) => {
            let histogramBar = new HistogramBarVO(d, 
            // @ts-ignore
            this.rangeXLog.middlewidth, xType);
            if (xType === HistogramType.XLIN) {
                histogramBar.computeXLin(bars);
            }
            else {
                histogramBar.computeXLog(bars);
            }
            bars.push(histogramBar);
        });
        return bars;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.0.4", ngImport: i0, type: HistogramService, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "18.0.4", ngImport: i0, type: HistogramService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.0.4", ngImport: i0, type: HistogramService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWtoaW9wcy1oaXN0b2dyYW0uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1raGlvcHMtaGlzdG9ncmFtL3NyYy9saWIvc2VydmljZXMvbmd4LWtoaW9wcy1oaXN0b2dyYW0uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUN0RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0scUNBQXFDLENBQUM7O0FBV3BFLE1BQU0sT0FBTyxnQkFBZ0I7SUFIN0I7UUFJRSxjQUFTLEdBQWUsRUFBRSxDQUFDO1FBQzNCLGNBQVMsR0FBVyxDQUFDLENBQUM7UUFDdEIsY0FBUyxHQUFlO1lBQ3RCLEdBQUcsRUFBRSxDQUFDO1lBQ04sR0FBRyxFQUFFLENBQUM7U0FDUCxDQUFDO1FBQ0YsY0FBUyxHQUFlLEVBQUUsQ0FBQztLQW9HNUI7SUFsR0MsU0FBUyxDQUFDLEtBQXlCO1FBQ2pDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFtQjtZQUMzRCxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3RELENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzQyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQzNDLENBQW1CO1lBRW5CLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FB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QixLQUF5QixFQUN6QixLQUFhO1FBRWIsSUFBSSxJQUFJLEdBQXFCLEVBQUUsQ0FBQztRQUVoQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBbUIsRUFBRSxDQUFTLEVBQUUsRUFBRTtZQUMvQyxJQUFJLFlBQVksR0FBRyxJQUFJLGNBQWMsQ0FDbkMsQ0FBQztZQUNELGFBQWE7WUFDYixJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFDMUIsS0FBSyxDQUNOLENBQUM7WUFDRixJQUFJLEtBQUssS0FBSyxhQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ2pDLFlBQVksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDakMsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLFlBQVksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDakMsQ0FBQztZQUNELElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDMUIsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7OEdBMUdVLGdCQUFnQjtrSEFBaEIsZ0JBQWdCLGNBRmYsTUFBTTs7MkZBRVAsZ0JBQWdCO2tCQUg1QixVQUFVO21CQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSGlzdG9ncmFtQmFyVk8gfSBmcm9tICcuLi9tb2RlbC9uZ3gta2hpb3BzLWhpc3RvZ3JhbS5iYXItdm8nO1xyXG5pbXBvcnQgeyBIaXN0b2dyYW1UeXBlIH0gZnJvbSAnLi4vbW9kZWwvbmd4LWtoaW9wcy1oaXN0b2dyYW0udHlwZXMnO1xyXG5pbXBvcnQge1xyXG4gIEhpc3RvZ3JhbVZhbHVlc0ksXHJcbiAgUmFuZ2VYTGluSSxcclxuICBSYW5nZVhMb2dJLFxyXG4gIFJhbmdlWUxvZ0ksXHJcbn0gZnJvbSAnLi4vaW50ZXJmYWNlcy9uZ3gta2hpb3BzLWhpc3RvZ3JhbS5pbnRlcmZhY2VzJztcclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICBwcm92aWRlZEluOiAncm9vdCcsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBIaXN0b2dyYW1TZXJ2aWNlIHtcclxuICByYW5nZVhMaW46IFJhbmdlWExpbkkgPSB7fTtcclxuICByYW5nZVlMaW46IG51bWJlciA9IDA7XHJcbiAgcmFuZ2VZTG9nOiBSYW5nZVlMb2dJID0ge1xyXG4gICAgbWluOiAwLFxyXG4gICAgbWF4OiAwLFxyXG4gIH07XHJcbiAgcmFuZ2VYTG9nOiBSYW5nZVhMb2dJID0ge307XHJcblxyXG4gIGdldFJhbmdlWChkYXRhczogSGlzdG9ncmFtVmFsdWVzSVtdKTogW1JhbmdlWExpbkksIFJhbmdlWExvZ0ldIHtcclxuICAgIHRoaXMucmFuZ2VYTG9nLmluZiA9IGRhdGFzLmZpbmQoZnVuY3Rpb24gKGQ6IEhpc3RvZ3JhbVZhbHVlc0kpIHtcclxuICAgICAgcmV0dXJuIGQucGFydGl0aW9uWzBdID09PSAwIHx8IGQucGFydGl0aW9uWzFdID09PSAwO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5yYW5nZVhMb2cubWluID0gZGF0YXNbMF0ucGFydGl0aW9uWzBdO1xyXG4gICAgdGhpcy5yYW5nZVhMb2cubmVnVmFsdWVzQ291bnQgPSBkYXRhcy5maWx0ZXIoZnVuY3Rpb24gKFxyXG4gICAgICBkOiBIaXN0b2dyYW1WYWx1ZXNJXHJcbiAgICApIHtcclxuICAgICAgcmV0dXJuIGQucGFydGl0aW9uWzFdIDwgMDtcclxuICAgIH0pPy5sZW5ndGg7XHJcbiAgICB0aGlzLnJhbmdlWExvZy5wb3NWYWx1ZXNDb3VudCA9IGRhdGFzLmZpbHRlcihmdW5jdGlvbiAoXHJcbiAgICAgIGQ6IEhpc3RvZ3JhbVZhbHVlc0lcclxuICAgICkge1xyXG4gICAgICByZXR1cm4gZC5wYXJ0aXRpb25bMV0gPiAwO1xyXG4gICAgfSk/Lmxlbmd0aDtcclxuICAgIGlmICh0aGlzLnJhbmdlWExvZy5pbmYpIHtcclxuICAgICAgLy8gMCBleGlzdFxyXG4gICAgICB0aGlzLnJhbmdlWExvZy5uZWdTdGFydCA9XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZSB1cGRhdGUgaXQgd2l0aCBlczIwMjNcclxuICAgICAgICBkYXRhcy5maW5kTGFzdChmdW5jdGlvbiAoZDogSGlzdG9ncmFtVmFsdWVzSSkge1xyXG4gICAgICAgICAgcmV0dXJuIGQucGFydGl0aW9uWzBdIDwgMCAmJiBkLnBhcnRpdGlvblsxXSA8PSAwO1xyXG4gICAgICAgIH0pPy5wYXJ0aXRpb25bMF0gfHwgdW5kZWZpbmVkO1xyXG4gICAgICB0aGlzLnJhbmdlWExvZy5wb3NTdGFydCA9XHJcbiAgICAgICAgZGF0YXMuZmluZChmdW5jdGlvbiAoZDogSGlzdG9ncmFtVmFsdWVzSSkge1xyXG4gICAgICAgICAgcmV0dXJuIGQucGFydGl0aW9uWzBdID4gMCAmJiBkLnBhcnRpdGlvblsxXSA+IDA7XHJcbiAgICAgICAgfSk/LnBhcnRpdGlvblswXSB8fCB1bmRlZmluZWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnJhbmdlWExvZy5uZWdTdGFydCA9XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZSB1cGRhdGUgaXQgd2l0aCBlczIwMjNcclxuICAgICAgICBkYXRhcy5maW5kTGFzdChmdW5jdGlvbiAoZDogSGlzdG9ncmFtVmFsdWVzSSkge1xyXG4gICAgICAgICAgcmV0dXJuIGQucGFydGl0aW9uWzBdIDwgMCAmJiBkLnBhcnRpdGlvblsxXSA8PSAwO1xyXG4gICAgICAgIH0pPy5wYXJ0aXRpb25bMV0gfHwgdW5kZWZpbmVkO1xyXG4gICAgICB0aGlzLnJhbmdlWExvZy5wb3NTdGFydCA9XHJcbiAgICAgICAgZGF0YXMuZmluZChmdW5jdGlvbiAoZDogSGlzdG9ncmFtVmFsdWVzSSkge1xyXG4gICAgICAgICAgcmV0dXJuIGQucGFydGl0aW9uWzBdID4gMCAmJiBkLnBhcnRpdGlvblsxXSA+IDA7XHJcbiAgICAgICAgfSk/LnBhcnRpdGlvblswXSB8fCB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5yYW5nZVhMb2cubWF4ID0gZGF0YXNbZGF0YXMubGVuZ3RoIC0gMV0ucGFydGl0aW9uWzFdO1xyXG5cclxuICAgIHRoaXMucmFuZ2VYTG9nLm1pZGRsZXdpZHRoID0gMS4yO1xyXG5cclxuICAgIHRoaXMucmFuZ2VYTGluLm1pbiA9IGRhdGFzWzBdLnBhcnRpdGlvblswXTtcclxuICAgIHRoaXMucmFuZ2VYTGluLm1heCA9IGRhdGFzW2RhdGFzLmxlbmd0aCAtIDFdLnBhcnRpdGlvblsxXTtcclxuXHJcbiAgICByZXR1cm4gW3RoaXMucmFuZ2VYTGluLCB0aGlzLnJhbmdlWExvZ107XHJcbiAgfVxyXG5cclxuICBnZXRMaW5SYW5nZVkoZGF0YXM6IEhpc3RvZ3JhbVZhbHVlc0lbXSk6IG51bWJlciB7XHJcbiAgICBjb25zdCBkYXRhVmFsdWVzID0gZGF0YXMubWFwKChkOiBIaXN0b2dyYW1WYWx1ZXNJKSA9PiBkLnZhbHVlKTtcclxuICAgIHRoaXMucmFuZ2VZTGluID0gTWF0aC5tYXgoLi4uZGF0YVZhbHVlcyk7XHJcbiAgICByZXR1cm4gdGhpcy5yYW5nZVlMaW47XHJcbiAgfVxyXG5cclxuICBnZXRMb2dSYW5nZVkoZGF0YXM6IEhpc3RvZ3JhbVZhbHVlc0lbXSk6IFJhbmdlWExpbkkge1xyXG4gICAgY29uc3QgZGF0YVZhbHVlcyA9IGRhdGFzLm1hcCgoZSkgPT4gZS5sb2dWYWx1ZSkuZmlsdGVyKChlKSA9PiBlICE9PSAwKTtcclxuICAgIHRoaXMucmFuZ2VZTG9nLm1heCA9IE1hdGgubWF4KC4uLmRhdGFWYWx1ZXMpO1xyXG4gICAgdGhpcy5yYW5nZVlMb2cubWluID0gTWF0aC5taW4oLi4uZGF0YVZhbHVlcyk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMucmFuZ2VZTG9nO1xyXG4gIH1cclxuXHJcbiAgZ2V0TGluUmF0aW9ZKGg6IG51bWJlciwgcGFkZGluZzogbnVtYmVyID0gMCk6IG51bWJlciB7XHJcbiAgICBsZXQgcmF0aW9ZID0gKGggLSBwYWRkaW5nIC8gMikgLyB0aGlzLnJhbmdlWUxpbjtcclxuICAgIHJldHVybiByYXRpb1k7XHJcbiAgfVxyXG5cclxuICBnZXRMb2dSYXRpb1koaDogbnVtYmVyLCBwYWRkaW5nOiBudW1iZXIgPSAwKTogbnVtYmVyIHtcclxuICAgIGxldCByYXRpb1k7XHJcbiAgICAvLyBAdHMtaWdub3JlXHJcbiAgICBsZXQgc2hpZnQgPSBNYXRoLmFicyh0aGlzLnJhbmdlWUxvZy5taW4pIC0gTWF0aC5hYnModGhpcy5yYW5nZVlMb2cubWF4KTtcclxuICAgIHJhdGlvWSA9IChoIC0gcGFkZGluZyAvIDIpIC8gc2hpZnQ7XHJcbiAgICByZXR1cm4gcmF0aW9ZO1xyXG4gIH1cclxuXHJcbiAgY29tcHV0ZVhiYXJzRGltZW5zaW9ucyhcclxuICAgIGRhdGFzOiBIaXN0b2dyYW1WYWx1ZXNJW10sXHJcbiAgICB4VHlwZTogc3RyaW5nXHJcbiAgKTogSGlzdG9ncmFtQmFyVk9bXSB7XHJcbiAgICBsZXQgYmFyczogSGlzdG9ncmFtQmFyVk9bXSA9IFtdO1xyXG5cclxuICAgIGRhdGFzLmZvckVhY2goKGQ6IEhpc3RvZ3JhbVZhbHVlc0ksIGk6IG51bWJlcikgPT4ge1xyXG4gICAgICBsZXQgaGlzdG9ncmFtQmFyID0gbmV3IEhpc3RvZ3JhbUJhclZPKFxyXG4gICAgICAgIGQsXHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIHRoaXMucmFuZ2VYTG9nLm1pZGRsZXdpZHRoLFxyXG4gICAgICAgIHhUeXBlXHJcbiAgICAgICk7XHJcbiAgICAgIGlmICh4VHlwZSA9PT0gSGlzdG9ncmFtVHlwZS5YTElOKSB7XHJcbiAgICAgICAgaGlzdG9ncmFtQmFyLmNvbXB1dGVYTGluKGJhcnMpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGhpc3RvZ3JhbUJhci5jb21wdXRlWExvZyhiYXJzKTtcclxuICAgICAgfVxyXG4gICAgICBiYXJzLnB1c2goaGlzdG9ncmFtQmFyKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGJhcnM7XHJcbiAgfVxyXG59XHJcbiJdfQ==